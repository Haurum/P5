\chapter{Increment two}
\label{chap:Increment two}
This chapter is just like the chapter above. The results from increment one will be discussed and implemented and this should result in the same, new or changed requirements as well.  

\section{Requirements}
\label{sec:i2Requirements}
The requirement marked with blue will be considered throughout this chapter.

\begin{itemize}
	\item The trash bin should catch the trash if the user throws it towards the trash bin and within a predefined area
	\begin{itemize}
		\item {The robots predefined area should be calculated from the hardware limitations of the motors’ speed}
	\end{itemize}
	\item The robot should know where it is positioned
	\begin{itemize}
		\item \textcolor{blue}{The robot should have a starting position, from where it should be able to calculate it's current position through calculations of the motory encoders}
		\item {The robot's starting point should be placed outside its predefined area, such that it moves forward into the area}
	\end{itemize}
	\item The robot should be able to detect and track the thrown trash
	\begin{itemize}
		\item {The thrown trash should be detected and tracked by a Microsoft Kinect}
		\item \textcolor{blue}{The Kinect should send the coordinates of the impact point of the trash to the robot}
	\end{itemize}
	\item The robot should know where the the thrown trash will land
	\begin{itemize}
		\item {Trajectory prediction should be used to calculate impact point of the thrown trash}
	\end{itemize}
	\item The robot should be able to move the trash bin, such that the thrown trash lands inside the bin
	\begin{itemize}
		\item {The robot should be able to turn and drive forward}
	\end{itemize}
	\item \textcolor{blue}{The robot should be able to receive data from a computer, through a wireless network}
\end{itemize}

\section{System design}
 \label{sec:i2System design} 
In this section, the marked requirements should be fulfilled and will be described and explained.  

\subsection{Wifi Shield}
\label{sec:Wifi Shield SD}
When the Kinect have found the coordinates for the collision point of the thrown object, these coordinates should be sent to the robot, for it to be able to move to the collision point and catch the object. 
The data should be sent, as earlier mentioned in section \ref{sec: Arduino Wifi Shield}, by the Arduino wifi shield. The Arduino and the computer running the Kinect program, should be connected to their own network, with the computer sending data to the wifi shields IP-address.

\subsection{Robot positioning}
\label{sec:Robot positioning System Design}
In the previous chapter, it was decided to use the motor's encoders to calculate the heading of the robot and the distance it has moved. The encoders will keep track of the number of degrees the specific motor have turned, which can be calculated to a distance using the wheels circumference.
The coordinate set for the collision point of the object and the robots current position, will be used to calculate the heading, which the robot should have to reach the collision point. 

(Hvordan vi oversætter Kinect X/Y til robot X/Y)

\section{Implementation}
\label{sec:i2Implementation}
This section explains how the marked requirements were actually implemented in the project and whether or not the requirements have been changed, removed or been fulfilled. 

\subsection{Wifi Shield}
\label{sec:Wifi Shield Implementation}
To implement the Wifi Shield as part of the Arduino, the router connecting the Wifi Shield with a computer had to be port forwarded. The private network hosted by the D-link router had a specific ssid and password, which had to be explicitly assigned in the Arduino code for the Wifi Shield. The setup in the Arduino code was used to start the connection between the computer and the Wifi Shield, as well as printing the log of the connection. The setup for the wifi shield can be found in listing \ref{ws}.

\begin{lstlisting}[caption={Connecting the Wifi shield to the network}, label={ws}]
void setup() {
  Serial.begin(9600);

  Serial.println("Attempting to connect to WPA network...");
  status = WiFi.begin(ssid, pass);

  if ( status != WL_CONNECTED) { 
    Serial.println("Couldn't get a wifi connection");
    while(true);
  } 
  else {
    server.begin();
    Serial.println("Connected to network");
  }
  ip = WiFi.localIP();
  Serial.println(ip);
}
\end{lstlisting}

After connecting the Wifi Shield to the router, the Arduino is ready to receive data. The data will be sent from a laptop, which connects and sends data as shown in \ref{cws}. A tcpClient is created and connected to the IP of the Wifi Shield, and the port that has been forwarded. The data sent in the code is a string "test", which is sent as a byte-array, and after sending the data, the tcpClient closes the connection.

\begin{lstlisting}[caption={Connecting the computer to the Wifi Shield}, label={cws}]
tcpClient.Connect("192.168.0.100", 9999);
string data = "test";
const int IntSize = 4;
byte[] bytedata;
Stream stream = tcpClient.GetStream();

stream.Write(Encoding.UTF8.GetBytes(data.ToCharArray()), 0, data.Length);
tcpClient.Close();
\end{lstlisting}

When both the computer and the Wifi shield has made the connection, and the computer has sent the data, the Arduino can then receive the data. This is done through a Wifi client, from the Arduino Wifi library. When assigning the client to the server.available, the value of the client in an if-statement would be true if any client from the server has data available for reading, or false if no data was available. If a client is connected, and the client has data available for reading, the next byte will be appended on the string readString, and after all the data available has been read, the full string sent by the client will be printed.

\begin{lstlisting}[caption={Receiving data from the computer}, label={rdc}]
client = server.available();
while (client.connected()){
if (client.available()) {
char c = client.read(); 
readString += c;
}
}
if(readString != ""){
Serial.println(readString);
readString = "";
}
\end{lstlisting}

\subsection{Robot positioning}
\label{sec:Robot positioning Implementation}

\section{Evaluation}
\label{sec:i2Evaluation}
This section will include a short summary of the chapter and conclude with an updated requirement list, showing changes from the first requirement list in the chapter. 