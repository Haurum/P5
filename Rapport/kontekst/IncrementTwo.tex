\chapter{Increment two}
\label{chap:Increment two}

\section{Requirements}
\label{sec:i2Requirements}

\section{System design}
\label{sec:i2System design}

\subsection{Wifi Shield}
\label{sec:Wifi Shield SD}
When the Kinect have found the coordinates for the collision point of the thrown object, these coordinates should be sent to the robot, for it ot be able to move to the collision point and catch the object. 
The data should be sent, as earlier mentioned in section \ref{sec: Arduino Wifi Shield}, by the Arduino wifi shiled. The Arduino and the computer running the Kinect program, should be connected to their own network, with the computer sending the data to the wifi shields IP-address.

\section{Implementation}
\label{sec:i2Implementation}

\subsection{Wifi Shield}
\label{sec:Wifi Shield Implementation}
To implement the Wifi Shield as part of the Arduino, the router connecting the Wifi Shield with a computer had to be port forwarded. The private network hosted by the D-link router had a specific ssid and password, which had to be explicitly assigned in the Arduino code for the Wifi Shield. The setup in the Arduino code was used to start the connection between the computer and the Wifi Shield, as well as printing the log of the connection \ref{ws}.

\begin{lstlisting}[caption={Connecting the Wifi shield to the network}, label={ws}]
void setup() {
  Serial.begin(9600);

  Serial.println("Attempting to connect to WPA network...");
  status = WiFi.begin(ssid, pass);

  if ( status != WL_CONNECTED) { 
    Serial.println("Couldn't get a wifi connection");
    while(true);
  } 
  else {
    server.begin();
    Serial.println("Connected to network");
  }
  ip = WiFi.localIP();
  Serial.println(ip);
}
\end{lstlisting}

After connecting the Wifi Shield to the router, the Arduino is ready to receive data. The data will be sent from a laptop, which connects and send data as shown in \ref{cws}. A tcpClient is created and connected to the IP of the WIfi Shield, and the port that has been forwarded. The data sent in the code is a string "test", which is sent as a byte-array, and after sending the data, the tcpClient closes the connection.

\begin{lstlisting}[caption={Connecting the computer to the Wifi Shield}, label={cws}]
tcpClient.Connect("192.168.0.100", 9999);
string data = "test";
const int IntSize = 4;
byte[] bytedata;
Stream stream = tcpClient.GetStream();

stream.Write(Encoding.UTF8.GetBytes(data.ToCharArray()), 0, data.Length);
tcpClient.Close();
\end{lstlisting}

When both the computer and the Wifi shield has made the connection, and the computer has sent the data, the Arduino can then receive the data. This is done through a Wifi client, from the Arduino Wifi library. When assigning the client to the server.available, the value of the client in an if-statement would be true if any client from the server has data available for reading, or false if no data was available. If a the client is connected, and the client has data available for reading, the next byte will be appended on the string readString, and after all the data available has been read, the full string sent by the client will be printed.

\begin{lstlisting}[caption={Receiving data from the computer}, label={rdc}]
client = server.available();
while (client.connected()){
if (client.available()) {
char c = client.read(); 
readString += c;
}
}
if(readString != ""){
Serial.println(readString);
readString = "";
}
\end{lstlisting}

(\textcolor{red}{The code describing how it receives data is needed here!})

\section{Evaluation}
\label{sec:i2Evaluation}
